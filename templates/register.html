<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <meta charset="utf-8">
    <title>用户注册界面</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="{% static 'lib/layui-v2.6.3/css/layui.css' %}" media="all">
    <link rel="stylesheet" href="{% static 'css/public.css' %}" media="all">
    <link rel="stylesheet" href="{% static 'js/lay-module/step-lay/step.css' %}" media="all">
    <script>
        function show_test(){
            var name = document.getElementById("user_name").value;
            var email = document.getElementById("user_email").value;
            var type = document.getElementById("user_type").value;
            document.getElementById("name_show").value = name;
            document.getElementById("email_show").value = email;
            document.getElementById("type_show").value = type;
        }


    </script>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">

        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
            <div style="background-color: #1aa094;width:100%">
            <legend><b>现代服务业发展水平评估系统<br>用户注册界面</b></legend>
            </div>
        </fieldset>
        <div class="layui-fluid">
            <div class="layui-card">
                <div class="layui-card-body" style="padding-top: 40px;">
                    <div class="layui-carousel" id="stepForm" lay-filter="stepForm" style="margin: 0 auto;">
                        <div carousel-item>
                            <div>
                                <form class="layui-form" id = "register_form" style="margin: 0 auto;max-width: 460px;padding-top: 40px;">
                                     <div class="layui-form-item">
                                        <label class="layui-form-label">用户名:</label>
                                        <div class="layui-input-block">
                                            <input id="user_name" type="text" name="user_name" placeholder="请填写用户名" class="layui-input" lay-verify="" required />

                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <label class="layui-form-label">用户邮箱:</label>
                                        <div class="layui-input-block">
                                            <input id="user_email" type="text" name="user_email" placeholder="请填写用户邮箱" class="layui-input" lay-verify="email" required />
                                            <button class="layui-btn" id="send_email"  type = "button" >
                                                &emsp;点击发送验证码&emsp;
                                            </button>
                                        </div>

                                    </div>

                                    <div class="layui-form-item">
                                        <label class="layui-form-label">验证码:</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="v_code" id="v_code" placeholder="请填写邮箱收到的验证码" value="" class="layui-input" lay-verify="number" >
                                            <input type="hidden" name="h_code" id="h_code" value="">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">账号密码:</label>
                                        <div class="layui-input-block">
                                            <input type="password" id="user_pwd" name="user_pwd" lay-verify="required|pass" placeholder="请输入密码" autocomplete="off" class="layui-input" value="">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">请重新输入密码:</label>
                                        <div class="layui-input-block">
                                            <input type="password" name="pwd_confirm" lay-verify="confirmPass" placeholder="请重新输入密码" autocomplete="off" class="layui-input" value="">
                                        </div>
                                    </div>
                                    <!--div class="layui-form-item">
                                        <label class="layui-form-label">用户手机号:</label>
                                        <div class="layui-input-block">
                                            <input type="text" placeholder="请填写用户手机号" class="layui-input" lay-verify="phone" />

                                        </div>
                                    </div-->
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">用户类型:</label>
                                        <div class="layui-input-block" >
                                            <select lay-verify="required" id="user_type" name="user_type">
                                                <option value="企业用户" selected>企业用户</option>
                                                <option value="政府用户">政府用户</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--div class="layui-form-item">
                                        <label class="layui-form-label">备注说明:</label>
                                        <div class="layui-input-block">
                                            <textarea placeholder="入款备注" value="" class="layui-textarea"></textarea>
                                        </div>
                                    </-->
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button class="layui-btn" lay-submit lay-filter="formStep" >
                                                &emsp;下一步&emsp;
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div>
                                <form class="layui-form" style="margin: 0 auto;max-width: 460px;padding-top: 40px;">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">用户名:</label>
                                        <div class="layui-input-block">
                                           <input id="name_show" type="text" readonly="readonly" value="" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">用户邮箱:</label>
                                        <div class="layui-input-block">
                                            <input id="email_show" type="text" readonly="readonly" value="" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">用户类型:</label>
                                        <div class="layui-input-block">
                                             <input id="type_show" type="text" readonly="readonly" value="" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button type="button" class="layui-btn layui-btn-primary pre">上一步</button>
                                            <button class="layui-btn" lay-submit lay-filter="formStep2" id="submit_bt" >
                                                &emsp;确认注册&emsp;
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div>
                                <div style="text-align: center;margin-top: 90px;" >
                                    <div id="text_show"  style="text-align: center;margin-top: 90px;"> </div>
                                    <div style="font-size: 24px;color: #333;font-weight: 500;margin-top: 30px;">
                                        <div class="layui-input-block">
                                         <input id="result_show" type="text" readonly="readonly" value="" class="layui-input" style="border-style:none;width:40%">
                                        </div>
                                    </div>
                                    <div style="font-size: 14px;color: #666;margin-top: 20px;">预计两小时到账</div>
                                </div>
                                <div style="text-align: center;margin-top: 50px;">
                                    <button class="layui-btn next">再入一笔</button>
                                    <button class="layui-btn layui-btn-primary">查看账单</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div style="color: #666;margin-top: 30px;margin-bottom: 40px;padding-left: 30px;">
                        <h3>说明</h3><br>
                        <h4>这是只实现了功能的注册界面</h4>
                        <p>如果需要，这里的布局可以随时改动</p>

                         <h4>例如添加手机号等模块</h4>
                        <p>都可以改都可以改都可以改都可以改</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<script src="{% static 'lib/layui-v2.6.3/layui.js' %}" charset="utf-8"></script>
<script src="{% static 'js/lay-config.js' %}" charset="utf-8"></script>
<script>
    layui.use([ 'form', 'step'], function () {
        var $ = layui.$,
            form = layui.form,
            step = layui.step;

        step.render({
            elem: '#stepForm',
            filter: 'stepForm',
            width: '100%', //设置容器宽度
            stepWidth: '750px',
            height: '500px',
            stepItems: [{
                title: '填写用户信息'
            }, {
                title: '确认用户信息'
            }, {
                title: '完成注册'
            }]
        });




        //发送验证码模块js代码
        var but = document.getElementById("send_email")
                    var time = 60; //定义剩下的秒数
                    but.addEventListener('click', function() {
                        but.disabled = true;
                        var email = document.getElementById("user_email").value;
                        var hcode = document.getElementById("h_code")
                        $.ajax({
                            url:'/sendVcode',
                            method: 'get',
                            data:{'user_email': email},
                            success: function(code){
                                hcode.value = code
                            }
                        })
                        var timer = setInterval(function() {
                            if (time == 0) {
                                //清除定时器和复原按钮
                                clearInterval(timer);
                                but.disabled = false;
                                but.innerHTML = '重新发送验证码';
                                time = 60; //这个10是重新开始
                            } else {
                                but.innerHTML = '请在' + time + '秒后重试';
                                time--;
                            }
                        }, 1000);
                    })

        var but2 = document.getElementById("submit_bt")
        but2.addEventListener('click',function register(){
            alert("test1")
            //var data1 = document.getElementById("register_form")
            //var data2 =data1.serialize()

            var user_name = document.getElementById("user_name").value
            var user_pwd = document.getElementById("user_pwd").value
            var user_type = document.getElementById("user_type").value
            var user_email = document.getElementById("user_email").value
            var v_code = document.getElementById("v_code").value
            var h_code = document.getElementById("h_code").value

            var text1 = document.getElementById("text_show")
            var text2 = document.getElementById("result_show")
            alert("test2")
            $.ajax({
                type : "POST",
                url : "/register_handle/",
                data:{"user_name":user_name,
                      "user_pwd" :user_pwd,
                      "user_type":user_type,
                      "user_email":user_email,
                      "v_code":v_code,
                      "h_code":h_code
                },
                 error: function(request) {
                    alert("Connection error");
                    },
                success : function(res){
                    if(res != null){
                        text_forshow = "注册成功！您的ID为："+res+",之后可凭邮箱以及此ID登录本系统，请牢记。"
                        text2.value =text_forshow
                    }
                    else{
                        text2.value="注册失败"
                    }
                }
            })

        })

        form.on('submit(formStep)', function (data) {
            show_test()
            step.next('#stepForm');
            return false;
        });

        form.on('submit(formStep2)', function (data) {

            step.next('#stepForm');
            return false;
        });

        form.verify(
            {
                confirmPass:function(value){
                     if($('input[name=user_pwd]').val() !== value)
                        return '提示：两次输入密码不一致！';

                }
            }
        )

        $('.pre').click(function () {
            step.pre('#stepForm');
        });

        $('.next').click(function () {
            step.next('#stepForm');
        });


    })
</script>
<!--script>
    var bt_send = document.getElementById("send_email");
    alert("nice");
    bt_send.click(function (){
        var email = document.getElementById("user_email").value;
        $.ajax({
            url:'sendVcode',
            method: 'get',
            data:{'user_email': email},
            success: function(code){
                alert(code);
            }
        })
    })
</script-->
</body>
</html>